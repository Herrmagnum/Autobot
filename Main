# include <Servo.h>
Servo FrontStering;
Servo motor;
// TIMERS
unsigned long lasttime=0; 
unsigned long currenttime=0;
unsigned long lastangletime=0;
unsigned long inputintervall=220000;      //Microsekunder mellan PID beräkningar


long integral =0;
int state=HIGH;                              //signal från hall
int oldstate=HIGH;
double v=0;                               //Hastighet cm/s
double vold=0;
double Omkrets=20.4;                         //Omkrets på hjulet 
double Setpoint;


int Myservo = 13;
int Mymotor = 12;

void setup()
{
 
  pinMode(Myservo,OUTPUT);            //sätter främre servo motor som output
  pinMode(Mymotor,OUTPUT);            //sätter dc motor som output
  
  FrontStering.attach(Myservo);       //kopplat Dc till pin 9
  motor.attach(Mymotor);             //kopplat främre servo till pin 13
  Setpoint = 140;
  
  
  
  // KAN BEHÖVAS EN UPPSTARTS SEKVENS FÖR REGULATORERNA

}

void loop() {
  
  
}

void SetSteering(float angle)
{

Myservo.write(angle);
  
}

void SetSpeed(float mps)
{
Mymotor.write(mps);
 
}

void PIcontroler(){
    double Sampletime=0.2;
    double P=0.00856;
    double I=0.0856;

    integral=integral+(Setpoint-v)*Sampletime; //Updaterar integralen med antagandet att sampletiden är konstant
    angle=90+P*(Setpoint-v)+integral*I;        //Beräknar vinkeln, regulatorn går från 90.
    motor.write(angle);
    lastangletime=currenttime;                 //lastangletime är tiden då vinkeln till motorn senast ändrats
}
